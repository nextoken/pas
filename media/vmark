#!/usr/bin/env python3
# @pas-executable
"""
Overlay a watermark image onto a video using ffmpeg.
"""
import argparse
import subprocess
import sys
import os

def main():
    parser = argparse.ArgumentParser(description="Overlay a watermark image onto a video using ffmpeg.")
    parser.add_argument('input_video', help='Input video file (e.g. input.mp4)')
    parser.add_argument('overlay_image', help='Overlay image file (e.g. overlay.png)')
    parser.add_argument('-o', '--output', help='Output video file (default: input_watermark.mp4)')
    args = parser.parse_args()

    input_video = args.input_video
    overlay_image = args.overlay_image
    if args.output:
        output_video = args.output
    else:
        base, ext = os.path.splitext(input_video)
        output_video = f"{base}_watermark.mp4"

    ffmpeg_cmd = [
        'ffmpeg',
        '-i', input_video,
        '-i', overlay_image,
        '-filter_complex', 'overlay=W-w-0:H-h-0',
        '-codec:a', 'copy',
        output_video
    ]

    try:
        subprocess.run(ffmpeg_cmd, check=True)
    except subprocess.CalledProcessError as e:
        print(f"Error running ffmpeg: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()